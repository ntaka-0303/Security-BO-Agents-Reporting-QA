# F-010 バックオフィス検証画面 仕様書

## 1. 概要

* **ドキュメント名**：F-010 バックオフィス検証画面 仕様書
* **対象機能**：バックオフィス担当がエスカレーション内容と帳票・AI出力を参照し、補足調査と回答案編集を行う UI
* **対応する機能要件**：業務要件 P-010、機能要件 F-010
* **担当者**：Reporting QA バックオフィスUIチーム
* **前提条件**：
  - F-009 でエスカレーションが登録済み
  - 帳票データ・AI回答・根拠を参照できる権限を保有
  - バックオフィス担当アカウントが SSO 済み
* **制約条件**：
  - 回答案には最終確認者の入力が必須
  - 返送時には SLA チェック（期日超過警告）
  - 編集履歴は監査用に全て保存

---

## 2. 画面仕様

### 2.1 概要

* **画面ID**：BO-001
* **画面名称**：バックオフィス検証
* **利用者ロール**：専門調査担当

### 2.2 レイアウト

```
左：案件概要（顧客/理由/期限）
中央：帳票プレビュー＋AI回答参照（タブ）
右：コメント履歴、追加調査メモ
下：回答案エディタ、最終確認者入力、返送ボタン
```

### 2.3 項目

| ID | 名称 | 型 | 必須 | 備考 |
| -- | ---- | -- | ---- | ---- |
| ITM-501 | 案件概要 | panel | ○ | 読み取り専用 |
| ITM-502 | 帳票プレビュー | viewer | ○ | 複数帳票切替 |
| ITM-503 | AI回答参照 | viewer | ○ | 最新版 |
| ITM-504 | バックオフィス回答案 | rich text | ○ | Markdown可 |
| ITM-505 | 追加根拠リンク | list | △ | URL複数 |
| ITM-506 | 最終確認者 | text | ○ | 50文字 |
| ITM-507 | 返送コメント | textarea | △ | 1000文字 |

### 2.4 アクション

| アクションID | 名称 | 処理 |
| ------------ | ---- | ---- |
| ACT-501 | 回答案保存 | バックオフィス回答をドラフト保存 |
| ACT-502 | オペレーターへ返送 | 回答案を F-006/F-008 へ送付 |
| ACT-503 | 追加資料リクエスト | オペレーターへ情報不足通知 |

### 2.5 エラー

| No | メッセージ | 条件 |
| -- | ---------- | ---- |
| ERR-080 | 最終確認者を入力してください。 | 未入力 |
| ERR-081 | 期限を超過しています。SLA理由を記載してください。 | 期限超過かつ返送 |

---

## 3. 処理仕様

### 3.1 フロー

1. エスカレーション ID から案件データを読込
2. 帳票/AI出力を参照タブで表示
3. 回答案編集・補足根拠追加
4. 保存時は `bo_response_text` と根拠を DB 更新
5. 返送時は F-006 へ新しいバージョンとして送信

### 3.2 詳細

| 手順 | 入力 | 出力 | 備考 |
| ---- | ---- | ---- | ---- |
| 1 | escalation_id | case bundle | ESC-001連携 |
| 2 | 編集 | draft | Auto-save |
| 3 | 保存 | draft | bo_response_text 更新 |
| 4 | 返送 | final draft | 通知 + status 更新 |
| 5 | SLAチェック | due_date | アラート表示 |

### 3.3 業務ルール

* 最終確認者は必ず社内資格者
* 回答案には根拠リンク（ページ/セクション）を明記
* 返送コメントで判定ロジック用タグ（例：追加調査済）を付与

### 3.4 例外処理

* 帳票プレビュー取得不可は再取得 or PDFダウンロード案内
* 返送API失敗は状態をドラフトに戻しリトライ
* SLA超過時、理由未入力なら返送不可

---

## 4. API / 外部システム連携

| API ID | 名称 | 説明 |
| ------ | ---- | ---- |
| API-BO-01 | 案件取得API | REST、本画面→バックエンド |
| API-BO-02 | 回答案保存API | REST、本画面→バックエンド |
| API-BO-03 | 返送通知API | REST、本画面→F-006/F-008 |

**返送リクエスト例**

```json
{
  "escalation_id": "ESC-123",
  "inquiry_id": "UUID",
  "bo_response_text": "...",
  "final_checker": "山田",
  "attachments": [],
  "status": "returned"
}
```

---

## 5. データ仕様

* `escalation`：`status` を `returned`、`bo_response_text` を更新
* `bo_response_history`（新規）：`history_id`, `escalation_id`, `checker`, `response_text`, `created_at`

---

## 6. シーケンス図

```
バックオフィス担当 →[案件要求]→ BO-001
BO-001 →[GET case]→ バックエンド
BO-001 ←[case data]← バックエンド
担当者 →[回答案保存]→ BO-001
BO-001 →[PUT save]→ バックエンド
担当者 →[返送]→ BO-001
BO-001 →[POST返送]→ オペレーターUI(F-006)
BO-001 →[更新]→ DB(escalation, bo_response_history)
```

